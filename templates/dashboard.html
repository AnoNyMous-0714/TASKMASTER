<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/sidebarstyle.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboardstyle.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>PSBA MANAGEMENT SYSTEM</title>
</head>
<body>

  <nav class="topnav">
    <a href="{{ url_for('dashboard') }}"><h2>TaskMaster</h2></a>
    <input type="text" placeholder="Search..">  
  </nav>
   
  <div class="invite_create">
    <button class="buttoninv" id="openInviteModal">Invite</button>
    <button class="buttoncreate" id="openCreateModal"><span class="tooltiptext">Create Task</span></button>
  </div>

  <div id="wrappers">
    <div class="sidebar close">
      <div class="logo-details">
        <i class='bx bx-menu'></i>
        <span class="logo_name">
            <div class="editable" onclick="makeEditable(this)">
                <span class="display placeholder">{{ username }}</span>
                <input size="15" type="text" class="edit-input" value="" onblur="saveName(this.parentElement)" onkeypress="handleKeyPress(event, this.parentElement)">
            </div>
        </span>
    </div>
    
      <ul class="nav-links">
        <li>
          <a href="{{ url_for('dashboard') }}">
            <i class='bx bx-grid-alt'></i>
            <span class="link_name">Dashboard</span>
          </a>
          <ul class="sub-menu blank">
            <li><a class="link_name" href="#">Dashboard</a></li>
          </ul>
        </li>
        <li>
          <div class="iocn-link">
            <a href="{{ url_for('about') }}">
              <i class="fa-regular fa-address-card"></i>
              <span class="link_name">About Us</span>
            </a>
          </div>
          <ul class="sub-menu blank">
            <li><a class="link_name" href="#">About Us</a></li>
          </ul>
        </li>
        <li>
          <div class="iocn-link">
            <a href="#">
              <i class='bx bx-cog'></i>
              <span class="link_name">Settings</span>
            </a>
            <i class='bx bxs-chevron-down arrow'></i>
          </div>
          <ul class="sub-menu">
            <li><a class="link_name" href="#">Settings</a></li>
            <li><a href="{{ url_for('help') }}">Help</a></li>
          </ul>
        </li>
        <li>
          <div class="profile-details">
            <div class="profile-content">
              <a href="{{ url_for('profile') }}">
                  <img id="sidebar-profile-image" src="{{ profile_picture }}" alt="profileImg">
              </a>
            </div>                 
            <div class="name-job">
              <div class="profile_name">{{ first_name }} {{ last_name }}</div>
            </div>
            <form action="{{ url_for('logout') }}" method="POST">
              <button type="submit" class="logout-btn"><i class='bx bx-log-out'></i></button>
            </form>
          </div>
        </li>
      </ul>
    </div>

    <div class="content">
      <section class="home-section">
        <div class="home-content">
          <button class="buttoncreate" id="openDashModal"><span class="tooltiptext">Create Task</span></button>
          <h1>To Do</h1>
          <div id="containerWrapper">
            {% for project in projects %}
            <div class="clickable-container" data-project-id="{{ project.project_id }}">
              <div class="title-container">
                <a href="{{ url_for('homepage', project_id=project.project_id) }}">
                  <div class="editablename">
                    <span class="editname placeholder">
                      <h3 ondblclick="editablename(this)">{{ project.project_name }}</h3>
                    </span>
                    <input size="15" type="text" class="edit-inputname" style="display: none;" value="" onblur="savename(this.parentElement)" onkeypress="handleKeyPress(event, this.parentElement)">
                  </div>
                </a>
                <div class="dropdown">
                  <button onclick="toggleDropdown(event)" class="dropbtnedit"><i class="fa-solid fa-ellipsis-vertical"></i></button>
                  <div id="myDropdownEdit" class="dropdown-content-edit">
                      <button class="edit-btn" onclick="openEditModal('{{ project.project_id }}', '{{ project.project_name }}', '{{ project.deadline }}', '{{ project.deadline_time }}', '{{ project.priority }}')">Edit</button>
                      <button class="delete-btn" onclick="deleteProject({{ project.project_id }})">Delete</button> 
                  </div>
                </div>
              </div>
              <div class="project-details">
                <p><strong>Deadline:</strong> {{ project.deadline }}</p>
                <p><strong>Time:</strong> {{ project.deadline_time }}</p>
                <p><strong>Priority:</strong> {{ project.priority }}</p>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </section>
    </div>

    <!-- Modal for confirmation -->
    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Deletion</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                  Are you sure you want to delete this project?
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
              </div>
          </div>
      </div>
    </div>

    <!-- Edit Modal -->
    <div class="bgmodal" id="bgeditModal">
      <div id="editModal" class="modal">
        <div class="modal-content">
          <span class="close edit-close" id="editModalClose">&times;</span>
          <h1>Edit Project</h1>
          <form id="editProjectForm">
            <input type="hidden" id="edit_project_id" name="edit_project_id" value="">
            <div class="parentcreate">
              <div class="title" id="editTitle">
                <input type="text" id="edit_project_name" name="edit_project_name" required>
              </div>
            </div>
            <div class="desc">
              <input type="date" id="edit_deadline" name="edit_deadline" required>
            </div>
            <div class="desc">
              <input type="time" id="edit_deadline_time" name="edit_deadline_time" required>
            </div>
            <div class="desc">
              <label for="edit_priority">Priority:</label>
              <select id="edit_priority" name="edit_priority" required>
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
              </select>
            </div>
            <div class="threebtn">
              <button type="button" class="editbtn" id="saveEditButton">Save</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Dash Modal -->
  <div class="bgmodal" id="bgdashModal">
    <div id="dashModal" class="modal">
      <div class="modal-content">
        <span class="close dash-close">&times;</span>
        <h1 class="createtask">Create Project</h1>
        <form method="POST" action="{{ url_for('create_project') }}" onsubmit="return validateDeadline()">
          <div id="wraps">
            <div class="parentcreate">
              <div class="title" id="createtitle">
                <input type="text" placeholder="Title" minlength="10" maxlength="17" id="project_name" name="project_name" required>
              </div>
            </div>
          </div>
  
          <div class="desc">
            <input type="date" id="deadline" name="deadline" required>
          </div>
  
          <div class="desc">
            <input type="time" id="deadline_time" name="deadline_time" required>
          </div>
  
          <div class="desc">
            <label for="priority">Priority:</label>
            <select id="priority" name="priority" required>
              <option value="High">High</option>
              <option value="Medium">Medium</option>
              <option value="Low">Low</option>
            </select>
          </div>
  
          {% if error %}
          <div class="error">{{ error }}</div>
          {% endif %}
  
          <div class="threebtn">
            <button class="createbtn" id="createContainerButton">Create</button>
          </div>
        </form>
      </div>
    </div>
  </div>

    <script src="{{ url_for('static', filename='js/dropdownsettings.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/sidebar.js') }}" defer></script> 
    <script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>  
    <script src="{{ url_for('static', filename='js/dashboardmodal.js') }}" defer></script>  
    <script src="{{ url_for('static', filename='js/dashedit.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/tasknameEDIT.js') }}" defer></script> 
    <script src="{{ url_for('static', filename='js/usernamesave.js') }}" defer></script>
  </div>
</body>
</html>
